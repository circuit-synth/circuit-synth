# kicad-sch-api Bug: Modifies Component Properties on Load/Save

## Summary

kicad-sch-api v0.3.0 has a critical bug that breaks bidirectional KiCad workflows. When loading and saving a schematic without modifications, it changes component properties from `(in_bom yes)` to `(in_bom no)` and removes pin UUIDs.

This causes `kicad-cli` netlist export to EXCLUDE components, breaking circuit-synth's bidirectional integration tests.

## Steps to Reproduce

```python
from circuit_synth import Component, circuit
import kicad_sch_api as ksa

# 1. Generate schematic with circuit-synth
@circuit(name="test")
def make_r1():
    return Component(symbol="Device:R", ref="R1", value="10k",
                    footprint="Resistor_SMD:R_0603_1608Metric")

c = make_r1()
c.generate_kicad_project(project_name="test_project")

# 2. Load with kicad-sch-api and save (NO MODIFICATIONS)
sch = ksa.Schematic.load("test_project/test_project.kicad_sch")
sch.save()

# 3. Compare before/after
# BEFORE: (in_bom yes) (on_board yes) + pin UUIDs present
# AFTER:  (in_bom no)  (on_board no)  + pin UUIDs removed
```

## Observed Behavior

### Before k icad-sch-api Load/Save (circuit-synth generated)
```
(symbol
    (lib_id "Device:R")
    (at 30.48 35.56 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom yes)        ← CORRECT
    (on_board yes)      ← CORRECT
    (dnp no)
    (uuid "...")
    (property "Reference" "R1" ...)
    (property "Value" "10k" ...)
    (pin "1" (uuid "..."))  ← PIN UUID PRESENT
    (pin "2" (uuid "..."))  ← PIN UUID PRESENT
    (instances ...)
)
```

### After kicad-sch-api Load/Save (unchanged code)
```
(symbol
    (lib_id "Device:R")
    (at 30.48 35.56 0)
    (unit 1)
    (exclude_from_sim no)
    (in_bom no)         ← CHANGED TO NO!
    (on_board no)       ← CHANGED TO NO!
    (dnp no)
    (uuid "...")
    (property "Reference" "R1" ...)
    (property "Value" "10k" ...)
    # NO PIN UUIDs!     ← PIN UUIDS REMOVED!
    (instances ...)
)
```

## Impact

1. **kicad-cli netlist export excludes components** with `(in_bom no)`
2. **circuit-synth import fails** - components generated by circuit-synth disappear after kicad-sch-api touches the file
3. **25 bidirectional_automated tests fail** - all workflows involving kicad-sch-api + circuit-synth roundtrips break
4. **Hierarchical designs break** - pin UUIDs are required for proper netlist connectivity

## Test Case

Test: `tests/test_bidirectional_automated/test_component_operations.py::test_06_add_component`

1. Generate circuit with R1 using circuit-synth ✅
2. Add R2 using kicad-sch-api ✅
3. Import back to Python using `import_kicad_project()` ❌
   - Expected: Both R1 and R2 imported
   - Actual: Only R2 imported (R1 has `in_bom no` so excluded from netlist)

## Root Cause

kicad-sch-api is not preserving all component properties when parsing and serializing .kicad_sch files. The library either:
1. Defaults to `(in_bom no)` when property is missing during parsing
2. Incorrectly serializes `(in_bom yes)` as `(in_bom no)`
3. Strips pin UUIDs during serialization

## Workaround

None currently. This requires a fix in kicad-sch-api or using a different version.

## Environment

- **kicad-sch-api version**: 0.3.0
- **KiCad version**: 9.0.0
- **circuit-synth version**: 0.11.0
- **Python**: 3.13
- **OS**: macOS 14.6.0

## Related Issues

- circuit-synth Issue #378: Components not appearing in netlist export
- Test failures: 25 tests in `tests/test_bidirectional_automated/` failing due to this bug

## Next Steps

1. Report bug to kicad-sch-api maintainers
2. Investigate if newer version fixes this
3. Consider alternative: patch kicad-sch-api locally or fork
4. Document workaround for users (avoid using kicad-sch-api on circuit-synth generated files)
